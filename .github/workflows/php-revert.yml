name: Revert PHP Releases

on:
  workflow_dispatch:
    inputs:
      minimum_version:
        description: 'Minimum version (e.g. 8.4.3)'
        required: false
        default: '0.0.0'
      maximum_version:
        description: 'Maximum version (empty = latest)'
        required: false
        default: ''

permissions:
  contents: write

jobs:
  cleanup:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6
        with:
          fetch-depth: 0

      - name: Delete Releases in Range
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          MIN_VER: ${{ inputs.minimum_version }}
          MAX_VER: ${{ inputs.maximum_version }}
        run: |
          if [ -z "$MAX_VER" ]; then MAX_VER="999.999.999"; fi

          echo "Target Range: v$MIN_VER -> v$MAX_VER"
          echo "----------------------------------------"

          git tag -l "v*" | sed 's/^v//' | sort -V | while read version; do
            
            if [ "$(echo -e "$version\n$MIN_VER" | sort -V | head -n1)" != "$MIN_VER" ]; then
              continue
            fi

            if [ "$(echo -e "$version\n$MAX_VER" | sort -V | tail -n1)" != "$MAX_VER" ]; then
              continue
            fi

            TAG="v$version"
            echo "üî• Deleting $TAG..."
            
            if ! gh release delete "$TAG" --cleanup-tag --yes 2>/dev/null; then
              git push origin --delete "$TAG" 2>/dev/null || echo "   ‚ö†Ô∏è Could not delete $TAG (maybe already gone)"
            fi
            
          done
          
          echo "----------------------------------------"
          echo "Cleanup finished."
